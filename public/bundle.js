(()=>{"use strict";function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t,i=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var i,n,r;return i=t,n=[{key:"init",value:function(e){this.initMovement(e)}},{key:"initMovement",value:function(e){var t=0,i=0,n=0,r=0;document.addEventListener("keydown",(function(a){switch(a.key){case"a":t=-1;break;case"d":i=1;break;case"w":n=-1;break;case"s":r=1}e.emit("velocityChange",{x:t+i,y:n+r})})),document.addEventListener("keyup",(function(a){switch(a.key){case"a":t=0;break;case"d":i=0;break;case"w":n=0;break;case"s":r=0}e.emit("velocityChange",{x:t+i,y:n+r})}))}}],r=[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}],n&&e(i.prototype,n),r&&e(i,r),t}();function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}!function(e){e.BgColor="#231f20",e.FloorColor="#93c09e",e.PlayerColor="#006a4e",e.PlayersColor="#136185",e.ItemColor="#e66916",e.NameColor="#F0FFF0"}(t||(t={}));var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var i,r,a;return i=e,a=[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}],(r=[{key:"init",value:function(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.height=.75*window.innerHeight,this.canvas.width=.75*window.innerWidth}},{key:"renderGame",value:function(e){this.renderWorld(e);var t=this.renderPlayer(e),i=t.playerX,n=t.playerY;this.renderPlayers(e,i,n),this.renderItems(e,i,n)}},{key:"renderWorld",value:function(e){this.ctx.fillStyle=t.BgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=t.FloorColor,this.ctx.fillRect(0,0,e.map.mapWidth*e.gridSize,e.map.mapHeight*e.gridSize)}},{key:"renderPlayer",value:function(e){var i,n,r=e.player,a=Math.ceil(this.canvas.width/e.gridSize),c=Math.ceil(this.canvas.height/e.gridSize);i=r.pos.x<=a/2?r.pos.x*e.gridSize:r.pos.x>=e.map.mapWidth-a/2?this.canvas.width-(e.map.mapWidth-r.pos.x)*e.gridSize:this.canvas.width/2,n=r.pos.y<=c/2?r.pos.y*e.gridSize:r.pos.y>=e.map.mapHeight-c/2?this.canvas.height-(e.map.mapHeight-r.pos.y)*e.gridSize:this.canvas.height/2,this.ctx.fillStyle=t.NameColor,this.ctx.font="25px Arial";var o=this.ctx.measureText(r.name).width;return this.ctx.fillText(r.name,i-o/2+e.gridSize/2,n-e.gridSize/2),this.ctx.fillStyle=t.PlayerColor,this.ctx.fillRect(i,n,e.gridSize,e.gridSize),{playerX:i,playerY:n}}},{key:"renderPlayers",value:function(e,i,n){var r=this,a=Math.ceil(this.canvas.width/e.gridSize),c=Math.ceil(this.canvas.height/e.gridSize);e.players.forEach((function(o){var s=o.pos.x-e.player.pos.x,l=o.pos.y-e.player.pos.y;if(Math.abs(s)<a&&Math.abs(l)<c){r.ctx.fillStyle=t.NameColor,r.ctx.font="25px Arial";var h=r.ctx.measureText(o.name).width;r.ctx.fillText(o.name,i+s*e.gridSize-h/2+e.gridSize/2,n+l*e.gridSize-e.gridSize/2),r.ctx.fillStyle=t.PlayersColor,r.ctx.fillRect(i+s*e.gridSize,n+l*e.gridSize,e.gridSize,e.gridSize)}}))}},{key:"renderItems",value:function(e,i,n){var r=this,a=Math.ceil(this.canvas.width/e.gridSize),c=Math.ceil(this.canvas.height/e.gridSize);e.items.forEach((function(o){var s=o.pos.x-e.player.pos.x,l=o.pos.y-e.player.pos.y;Math.abs(s)<a&&Math.abs(l)<c&&(r.ctx.fillStyle=t.ItemColor,r.ctx.fillRect(i+s*e.gridSize,n+l*e.gridSize,e.gridSize,e.gridSize))}))}}])&&n(i.prototype,r),a&&n(i,a),e}();function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l=io("/"),h=document.getElementById("game-screen"),u=document.getElementById("form-screen"),d=document.getElementById("nickname-form"),y=document.getElementById("username-input");d.addEventListener("submit",(function(e){e.preventDefault(),u.style.display="none",h.style.display="block",l.emit("playerInit","".concat(y.value)),l.on("staticState",(function(e){return new f(JSON.parse(e)).init()}))}));var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"controls",i.getInstance()),s(this,"renderer",r.getInstance()),this.staticState=t}var t,n;return t=e,(n=[{key:"init",value:function(){this.controls.init(l),this.renderer.init(),l.on("dynamicState",this.onDynamicStateChange.bind(this))}},{key:"onDynamicStateChange",value:function(e){var t=this,i=JSON.parse(e);requestAnimationFrame((function(){return t.renderer.renderGame(c(c({},t.staticState),i))}))}}])&&o(t.prototype,n),e}()})();
//# sourceMappingURL=bundle.js.map